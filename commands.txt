# Authenticate with Azure CLI
az login

# Install ansible-cmdb
pip install ansible-cmdb

# Deploy and configure Windows VM
ansible-playbook create_azure_winvm.yml -e @vars.yml --ask-vault-pass

# Test connection to Windows VM
ansible-playbook -i inventory_azure_rm.yml test_azure_winvm.yml -e @vars.yml --ask-vault-pass

# Install Windows File Server features
ansible-playbook -i inventory_azure_rm.yml windows_fs_config.yml -e @vars.yml --ask-vault-pass

# Deploy and configure Ubuntu VM
ansible-playbook create_azure_ubuntuvm.yml -e @vars.yml --ask-vault-pass

# Test login to Ubuntu VM
ssh azureadmin@<publicipaddress> -i tmp/id_ssh_rsa

# Install apt packages on Ubuntu VM
ansible-playbook -i inventory_azure_rm.yml apt_package_install.yml -e @vars.yml --ask-vault-pass

# View dynamic inventory
ansible-inventory -i inventory_azure_rm.yml -e @vars.yml --ask-vault-pass --list

# Generate CMDB in different formats
ansible-cmdb -f out/ > cmdb.html
ansible-cmdb -t markdown -f out/ > cmdb.md
ansible-cmdb -t sql -f out/ > cmdb.sql

# Cleanup & destroy resources
ansible-playbook cleanup_resources.yml -e @vars.yml --ask-vault-pass